<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Managed Website</title>
    <style>
        :root { --main: #0366d6; --dark: #24292e; --accent: #d73a49; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; margin: 0; background: #f6f8fa; }
        
        /* Navigation */
        nav { background: var(--dark); display: flex; flex-wrap: wrap; justify-content: center; padding: 10px; position: sticky; top: 0; z-index: 1000; }
        nav a { color: white; padding: 12px 20px; text-decoration: none; cursor: pointer; font-size: 14px; font-weight: 600; }
        nav a:hover { background: #444; border-radius: 6px; }
        .admin-btn { background: var(--accent); color: white !important; border-radius: 6px; margin-left: 10px; }

        /* Announcement Flash */
        #flash-bar { background: #fff3cd; color: #856404; padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #ffeeba; display: none; animation: flash 2s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .container { max-width: 900px; margin: 30px auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); min-height: 500px; }
        .page { display: none; }
        .active { display: block; }

        /* Gallery/Slideshow */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .gallery-grid img { width: 100%; height: 220px; object-fit: cover; border-radius: 12px; transition: transform 0.3s; cursor: pointer; }
        .gallery-grid img:hover { transform: scale(1.02); }

        h1, h2 { color: var(--dark); }
        .content-text { line-height: 1.8; font-size: 1.1rem; color: #444; white-space: pre-wrap; }
    </style>
</head>
<body>

<div id="flash-bar"></div>

<nav id="navbar">
    <a onclick="showPage('home')">Home</a>
    </nav>

<div class="container">
    <div id="home" class="page active">
        <h1>Home Gallery</h1>
        <p>A showcase of my latest uploads managed via Google Sheets.</p>
        <div id="home-gallery" class="gallery-grid"></div>
    </div>

    <div id="dynamic-content"></div>
</div>

<script>
    // 1. PASTE YOUR CSV LINK HERE
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRRI2c4orM9jF_GAp026cMFA-5yb99xUhs-ZDf6L-oQgz0bdqZVyx-Tml4V10IaaSInFbA0lAgGG4GK/pub?output=csv';

    async function init() {
        try {
            const response = await fetch(sheetUrl);
            const csvData = await response.text();
            const rows = csvData.split('\n').map(row => row.split(','));

            const nav = document.getElementById('navbar');
            const dynamicContent = document.getElementById('dynamic-content');
            const flashBar = document.getElementById('flash-bar');
            const homeGallery = document.getElementById('home-gallery');

            // Skip header row (i=1)
            for (let i = 1; i < rows.length; i++) {
                let [type, content, label] = rows[i].map(c => c?.replace(/"/g, '').trim());
                if (!type) continue;

                if (type.toLowerCase() === 'announcement') {
                    flashBar.innerText = content;
                    flashBar.style.display = 'block';
                }

                if (type.toLowerCase() === 'gallery') {
                    homeGallery.innerHTML += `<img src="${content}" onerror="this.src='https://via.placeholder.com/300?text=Invalid+Image+URL'">`;
                }

                if (type.toLowerCase() === 'tab') {
                    const id = 'page' + i;
                    nav.innerHTML += `<a onclick="showPage('${id}')">${label}</a>`;
                    dynamicContent.innerHTML += `
                        <div id="${id}" class="page">
                            <h2>${label}</h2>
                            <div class="content-text">${content}</div>
                        </div>`;
                }
            }
            // Add Admin Login button at the end
            nav.innerHTML += `<a href="${sheetUrl.replace('pub?output=csv', 'edit')}" target="_blank" class="admin-btn">Admin Log In</a>`;
        } catch (err) {
            console.error("Sheet loading failed", err);
        }
    }

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    init();
</script>

</body>
</html>
